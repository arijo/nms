define([
	'jquery',
	'underscore',
	'backbonejs',
	'raphael',

	'shared/nms/utils/random',

	'shared/nms/screen/shared/bubble',

	'shared/nmsui/popup/popup' ],
       
	function( $, _, Backbone, 
		  
		  Raphael, 

		  Random,

		  Bubble,

		  Popup ) {

			// MEDIA LIFE CYCLE ILLUSTRATION VIEW
			var MedialifecycleIllustration = Backbone.View.extend({

				// LAYOUT DEFAULTS
				layoutDefaults: {
					selector:     '#grid .screen.medialifecycle .illustrations',
					paper:        null,
					width:        null,
					height:       null,
					loopInterval: 500,
					intervalID:   null
				},

				// COLOR DEFAULTS
				colorDefaults: {
					background:  '#f8d011',
					foreground1: '#b72285',
					foreground2: '#f967d1',
					foreground3: '#d573ba',
					type1:       '#ffffff',
					type2:       '#ffffff',
					dots:        ['#fb67d1', '#ffffff']
				},
			
				// KEEP TRACK OF THE DOTS
				dots: {
					set:        null,
					count:      60,
					minSize:    4,
					maxSize:    15,
					minOpacity: 30,
					maxOpacity: 70
				},

				// HIGHWAY IMAGE PATHS
				highway: {
					set:         null,
					outline:     null,
					outlinePath: 'M412.559,364H388  c-10.744,0-20.947-2.321-30.133-6.49c3.225-4.33,5.133-9.696,5.133-15.51c0-14.359-11.641-26-26-26  c-5.813,0-11.18,1.909-15.51,5.133C317.321,311.947,315,301.745,315,291v-24.558V160h-26v106.442V291  c0,10.745-2.322,20.947-6.49,30.133C278.18,317.909,272.813,316,267,316c-14.359,0-26,11.641-26,26c0,5.813,1.908,11.18,5.132,15.51  C236.946,361.679,226.744,364,216,364h-24.559H8v26h183.441H216c10.744,0,20.946,2.322,30.132,6.49  C242.908,400.82,241,406.188,241,412c0,14.359,11.641,26,26,26c5.813,0,11.18-1.908,15.51-5.133  c4.168,9.187,6.49,19.389,6.49,30.133v152.9h26V487.559V463c0-10.744,2.321-20.946,6.49-30.133c4.33,3.225,9.696,5.133,15.51,5.133  c14.359,0,26-11.641,26-26c0-5.812-1.908-11.18-5.133-15.51c9.186-4.168,19.389-6.49,30.133-6.49h24.559H603v-26H412.559z M245,342  c0-12.15,9.85-22,22-22c5.188,0,9.957,1.797,13.718,4.802c-6.905,13.192-17.724,24.012-30.917,30.917  C246.797,351.957,245,347.188,245,342z M248.882,360.645c1.296,1.26,2.723,2.386,4.258,3.355h-12.582  C243.411,363.041,246.189,361.918,248.882,360.645z M240.558,390h12.582c-1.536,0.97-2.962,2.096-4.258,3.355  C246.189,392.082,243.411,390.959,240.558,390z M267,434c-12.15,0-22-9.85-22-22c0-5.188,1.797-9.957,4.802-13.719  c13.192,6.905,24.012,17.725,30.917,30.917C276.957,432.203,272.188,434,267,434z M289,438.441  c-0.959-2.853-2.082-5.631-3.355-8.323c1.26-1.296,2.386-2.723,3.355-4.259V438.441z M289,398.141V412  c0,5.464-1.993,10.461-5.29,14.309c-7.114-13.101-17.918-23.905-31.019-31.019c3.847-3.297,8.845-5.29,14.309-5.29h13.859H289  V398.141z M289,355.86V364h-8.141H267c-5.464,0-10.461-1.992-14.309-5.289c13.101-7.114,23.905-17.919,31.019-31.019  c3.297,3.847,5.29,8.845,5.29,14.308V355.86z M289,328.141c-0.97-1.536-2.096-2.962-3.355-4.258  c1.274-2.693,2.396-5.471,3.355-8.324V328.141z M337,320c12.15,0,22,9.85,22,22c0,5.188-1.797,9.957-4.802,13.719  c-13.192-6.905-24.013-17.725-30.917-30.917C327.043,321.797,331.812,320,337,320z M315,315.559  c0.959,2.853,2.082,5.631,3.355,8.324c-1.26,1.296-2.387,2.723-3.355,4.258V315.559z M315,355.86V342  c0-5.463,1.992-10.461,5.289-14.308c7.114,13.1,17.919,23.905,31.02,31.019C347.461,362.008,342.463,364,337,364h-13.859H315V355.86  z M315,438.441v-12.582c0.969,1.536,2.096,2.963,3.355,4.259C317.082,432.811,315.959,435.589,315,438.441z M320.289,426.309  C316.992,422.461,315,417.464,315,412v-13.859V390h8.141H337c5.463,0,10.461,1.993,14.309,5.29  C338.208,402.403,327.403,413.208,320.289,426.309z M359,412c0,12.15-9.85,22-22,22c-5.188,0-9.957-1.797-13.719-4.802  c6.904-13.192,17.725-24.012,30.917-30.917C357.203,402.043,359,406.812,359,412z M355.117,393.355  c-1.296-1.26-2.723-2.386-4.258-3.355h12.582C360.589,390.959,357.811,392.082,355.117,393.355z M350.859,364  c1.535-0.969,2.962-2.095,4.258-3.355c2.693,1.273,5.472,2.396,8.324,3.355H350.859z ' + 
								 'M301 160L301 616' + 
								 'M303 160L303 616' + 
								 'M7.9 378L289 378' +
								 'M7.9 376L289 376' +
								 'M315 378L603 378' +
								 'M315 376L603 376' +
								 'M289 364L289 390' +
								 'M315 364L315 390'
				},

				events: {
					'click .listtrigger': 'popupopen',
					'popupclose': 'popupclose'
				},

				initialize: function() {

					// SETUP POPUP WIDGET
					this.popup = new Popup({
						//html: $('#popups').find('.medialifecycle.popup').clone(),
						src: this.options.settings.baseUrl + 'pages/medialifecycle/popups/popup.html',
						listenerEl: this.$el,
						//width: 300,
						//height: 150,
						settings: this.options.settings			    
					});
				},

				popupopen: function( ev) {

					this.stop();

					this.popup.show();
				},

				popupclose: function( ev) {

					this.start();
				},

				transitionIntoBegin: function() {

					this.start();

					this.listtrigger.start();
				},

				transitionIntoComplete: function() {

					//this.listtrigger.start();

					this._animateTextContent();
				},

				transitionOffBegin: function() {

					this.popup.hide();
				},

				transitionOffComplete: function() {

					this.stop();
				},

				start: function() {

					var dots = this.dots, 
					    highway =   this.highway,
					    layout = this.layoutDefaults,
					    colors = this.colorDefaults;

					layout.width = $(window).width();	
					layout.height = $(window).height();

					layout.paper = Raphael(
						$(layout.selector)[0],
						layout.width,
						layout.height
					);

					dots.set = layout.paper.set()

					highway.outline = layout.paper.path('M412.559,364H388  c-10.744,0-20.947-2.321-30.133-6.49c3.225-4.33,5.133-9.696,5.133-15.51c0-14.359-11.641-26-26-26  c-5.813,0-11.18,1.909-15.51,5.133C317.321,311.947,315,301.745,315,291v-24.558V160h-26v106.442V291  c0,10.745-2.322,20.947-6.49,30.133C278.18,317.909,272.813,316,267,316c-14.359,0-26,11.641-26,26c0,5.813,1.908,11.18,5.132,15.51  C236.946,361.679,226.744,364,216,364h-24.559H8v26h183.441H216c10.744,0,20.946,2.322,30.132,6.49  C242.908,400.82,241,406.188,241,412c0,14.359,11.641,26,26,26c5.813,0,11.18-1.908,15.51-5.133  c4.168,9.187,6.49,19.389,6.49,30.133v152.9h26V487.559V463c0-10.744,2.321-20.946,6.49-30.133c4.33,3.225,9.696,5.133,15.51,5.133  c14.359,0,26-11.641,26-26c0-5.812-1.908-11.18-5.133-15.51c9.186-4.168,19.389-6.49,30.133-6.49h24.559H603v-26H412.559z M245,342  c0-12.15,9.85-22,22-22c5.188,0,9.957,1.797,13.718,4.802c-6.905,13.192-17.724,24.012-30.917,30.917  C246.797,351.957,245,347.188,245,342z M248.882,360.645c1.296,1.26,2.723,2.386,4.258,3.355h-12.582  C243.411,363.041,246.189,361.918,248.882,360.645z M240.558,390h12.582c-1.536,0.97-2.962,2.096-4.258,3.355  C246.189,392.082,243.411,390.959,240.558,390z M267,434c-12.15,0-22-9.85-22-22c0-5.188,1.797-9.957,4.802-13.719  c13.192,6.905,24.012,17.725,30.917,30.917C276.957,432.203,272.188,434,267,434z M289,438.441  c-0.959-2.853-2.082-5.631-3.355-8.323c1.26-1.296,2.386-2.723,3.355-4.259V438.441z M289,398.141V412  c0,5.464-1.993,10.461-5.29,14.309c-7.114-13.101-17.918-23.905-31.019-31.019c3.847-3.297,8.845-5.29,14.309-5.29h13.859H289  V398.141z M289,355.86V364h-8.141H267c-5.464,0-10.461-1.992-14.309-5.289c13.101-7.114,23.905-17.919,31.019-31.019  c3.297,3.847,5.29,8.845,5.29,14.308V355.86z M289,328.141c-0.97-1.536-2.096-2.962-3.355-4.258  c1.274-2.693,2.396-5.471,3.355-8.324V328.141z M337,320c12.15,0,22,9.85,22,22c0,5.188-1.797,9.957-4.802,13.719  c-13.192-6.905-24.013-17.725-30.917-30.917C327.043,321.797,331.812,320,337,320z M315,315.559  c0.959,2.853,2.082,5.631,3.355,8.324c-1.26,1.296-2.387,2.723-3.355,4.258V315.559z M315,355.86V342  c0-5.463,1.992-10.461,5.289-14.308c7.114,13.1,17.919,23.905,31.02,31.019C347.461,362.008,342.463,364,337,364h-13.859H315V355.86  z M315,438.441v-12.582c0.969,1.536,2.096,2.963,3.355,4.259C317.082,432.811,315.959,435.589,315,438.441z M320.289,426.309  C316.992,422.461,315,417.464,315,412v-13.859V390h8.141H337c5.463,0,10.461,1.993,14.309,5.29  C338.208,402.403,327.403,413.208,320.289,426.309z M359,412c0,12.15-9.85,22-22,22c-5.188,0-9.957-1.797-13.719-4.802  c6.904-13.192,17.725-24.012,30.917-30.917C357.203,402.043,359,406.812,359,412z M355.117,393.355  c-1.296-1.26-2.723-2.386-4.258-3.355h12.582C360.589,390.959,357.811,392.082,355.117,393.355z M350.859,364  c1.535-0.969,2.962-2.095,4.258-3.355c2.693,1.273,5.472,2.396,8.324,3.355H350.859z ' + 
						'M301 160L301 616' + 
						'M303 160L303 616' + 
						'M7.9 378L289 378' +
						'M7.9 376L289 376' +
						'M315 378L603 378' +
						'M315 376L603 376' +
						'M289 364L289 390' +
						'M315 364L315 390').attr({
							'stroke-width':      5,
							'stroke-miterlimit': 10
						});
					layout.paper.setStart();
					layout.paper.path(
						'M307 160L307 616' +
						'M293 160L293 616' + 
						'M297 160L297 616' + 
						'M311 160L311 616' +
						'M7.9 372L289 372' +
						'M7.9 386L289 386' +
						'M7.9 382L289 382' +
						'M7.9 368L289 368' +
						'M315 372L603 372' +
						'M315 386L603 386' +
						'M315 382L603 382' +
						'M315 368L603 368'
						).attr({
							'stroke-width':      2,
							'stroke-dasharray':  "- ",
							'stroke-miterlimit': 10
						});
					highway.set = layout.paper.setFinish();
					highway.set.push(highway.outline);
					highway.set
						.attr({
							opacity: '0.20'
						})
						.transform('T300-100,10R-30S7,7');
					highway.set.animate({
						transform: 'T300-150,10R-120S10,10'
					}, 300000, 'linear', function(){
						// call back
					});

					// DRAW THE LISTTRIGGER BUBBLE
					this.listtrigger = new Bubble({
						el: this.$el.find('.listtrigger'),
						layout: layout,
						floatBox: { id: 4, type: 'box', x: 0.43, y: 0.27, width: 1, height: 1 },
						floatSpeed: 3
					});

					// START THE ANIMATION LOOP
					this.clock = setInterval( 
						$.proxy( this.paint, this),
						layout.loopInterval
					);
				},

				// CALLED ONCE IN EACH ANIMATION LOOP
				paint: function() {

				       //console.log('paint');
				},	

				stop: function() {
					var layout = this.layoutDefaults;
					clearInterval( this.clock);
					layout.paper.clear();
				},

				resize: function() {

					this.stop();
					this.start();

					this.listtrigger.start();

					this.popup.resize();
				},

				getBgColor: function() {
					return this.colorDefaults.background;
				},

				_animateTextContent: function() {
					//console.log('Animating MediaLifeCycle text');

				}
			});

			return MedialifecycleIllustration;
});
